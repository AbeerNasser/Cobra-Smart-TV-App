<!DOCTYPE html>
<html lang="ar-eg">

<head>
    <meta charset="utf-8" /> 
    <title>COBRA IPTV</title>
    <!-- Custom Stylesheet -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/fa/css/all.css" rel="stylesheet">
    <script src="assets/js/jq.js"></script>
    <script src="assets/js/bootstrap.js"></script>
</head>

<body style="background-color:#060a2f; direction:rtl; font-family:Tajawal;" onLoad="allchannels()">

    <div class="container">
        <div class="mainHeader">
            <div class="row">

                <div class="col-md-3 col-lg-3 col-xl-3" style="text-align:right;">
                    <a data-toggle="modal" data-target="#searchModal"><img src="assets/images/search.png" width="30" /></a>
                </div>

                <div class="col-md-6 col-lg-6 col-xl-6">
                    <center>
                        <img src="assets/images/MainLogo.png" width="200" />
                    </center>
                </div>

                <div class="col-md-3 col-lg-3 col-xl-3">
                    <a href="channelCategories.html"><img src="assets/images/back.png" width="30" style="margin-right:20px;" /></a>
                </div>
            </div>
        </div>

        <hr class="diver">

        <div class="departments">

            <h3 style="text-align:right; color:white;" id="depname"> </h3>
            <br /><br />
            <!-- <video id="player" width="100%" height="auto" autoplay="autoplay" controls>
                <source  type="video/mime" codecs="avc1.42E01E, mp4a.40.2">
            </video>
            <hr> -->
            <div class="row" id="demo">
                
            </div>
        </div>

    </div>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-9">
                            <input type="search" id="search" class="form-control" placeholder="بحث عن فيلم, قناة, مسلسل" />
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-success btn-block" onclick="search()">بحث</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">إغلاق</button>
                </div>
            </div>
        </div>
    </div> 

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!-- <script src="jsmpeg.min.js"></script> -->
        <script>
            var videos = [];
            var username = sessionStorage.getItem("username")
            var password = sessionStorage.getItem("password")
            var server = sessionStorage.getItem("server")
            if(server == 'servname1'){
                var url = "http://cobraa.in:8000/player_api.php";
            }
            else{
                var url = "http://ui-tv.se:2095/player_api.php";
            }
            var queryString = decodeURIComponent(window.location.search);
            queryString = queryString.substring(7);
            var queries = queryString.split("&para2=");
            for (var i = 0; i < queries.length; i++)
            {
                var derpartmentid = queries[0] ;
                var derpartmentname = queries[1] ;
            }

            sessionStorage.setItem("categoryid", derpartmentid)
            sessionStorage.setItem("categoryname", derpartmentname)
 
			function allchannels(){

				let credintials = {
					username: username,
					password: password,
					action: "get_live_streams"
				};
				$.ajax({
			        url: url,
			        dataType: 'text',
			        type: "post",
	                contentType: 'application/x-www-form-urlencoded',
			        data: credintials,
			        dataType: 'json',
			        success: function(data) {
			           
			            for (i = 1; i < data.length; i++) {   
         
                            if(data[i]["category_id"]==derpartmentid){
                                videos.push(data[i]);
                                var channelid = data[i]["stream_id"];
                                var append = '<div class="col-md-3 col-lg-3 col-xl-3"><a id=demo'+ i +' width="100"/></a></div>'
    
                                $("#demo").last().append(append);
                                var demo = document.getElementById('demo'+i);
                                demo.href= "liveStream.html?" + channelid;
                                var imgsrc = data[i]["stream_icon"];
                                var vedioname = data[i]["name"];
                                document.getElementById('depname').innerHTML = derpartmentname;
                                demo.innerHTML = '<div class="card" style="background-color:#23274a; margin-bottom:20px;">'+
                                '<center><img src="'+imgsrc+'" width="120" style="padding-top:20px;"></center>'+
                                '<br />'+
                                '<p class="text-center text-light">'+vedioname+'</p>'+
                                '</div>';
                            }
			            }
			        }
			    }).done(function(msg) {
			        
			    });
			}

            function search(){
				var search = document.getElementById('search').value;
				$("#demo").empty();
				for (i = 0; i < videos.length; i++) {
					
					if(videos[i]["name"].toLowerCase().includes(search.toLowerCase())){
						var channelid = videos[i]["stream_id"];
                        var append = '<div class="col-md-3 col-lg-3 col-xl-3"><a id=demo'+ i +' width="100"/></a></div>'

                        $("#demo").last().append(append);
                        var demo = document.getElementById('demo'+i);
                        demo.href= "liveStream.html?" + channelid;
                        var imgsrc = videos[i]["stream_icon"];
                        var vedioname = videos[i]["name"];
                        document.getElementById('depname').innerHTML = derpartmentname;
                        demo.innerHTML = '<div class="card" style="background-color:#23274a; margin-bottom:20px;">'+
                        '<center><img src="'+imgsrc+'" width="120" style="padding-top:20px;"></center>'+
                        '<br />'+
                        '<p class="text-center text-light">'+vedioname+'</p>'+
                        '</div>';
					}
				}
				
			}
		</script>
</body>

</html>

<a href="https://flowplayer.com/hello/?from=player" style="display: block; position: absolute; left: 16px; bottom: 70px; z-index: 99999; width: 100px; height: 20px; background-image: url(&quot;https://d32wqyuo10o653.cloudfront.net/logo.png&quot;);"></a>