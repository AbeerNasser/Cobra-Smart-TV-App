<!DOCTYPE html>
<html lang="ar-eg">

<head>
    <title>COBRA IPTV</title>
    <!-- Custom Stylesheet -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/fa/css/all.css" rel="stylesheet">
    <script src="assets/js/jq.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <style>
        .demo:hover,.demo:focus{
            background: #fff;
        }
    </style>
</head>

<body style="background-color:#060a2f; direction:rtl; font-family:Tajawal;" onLoad="allmovies()">

    <div class="container">
        <div class="mainHeader">
            <div class="row">

                <div class="col-md-3 col-lg-3 col-xl-3" style="text-align:right;">
                    <a data-toggle="modal" data-target="#searchModal"><img src="assets/images/search.png" width="30" /></a>
                </div>

                <div class="col-md-6 col-lg-6 col-xl-6">
                    <center>
                        <img src="assets/images/MainLogo.png" width="200" />
                    </center>
                </div>

                <div class="col-md-3 col-lg-3 col-xl-3">
                    <a href="movies.html"><img src="assets/images/back.png" width="30" style="margin-right:20px;" /></a>
                </div>
            </div>
        </div>

        <hr class="diver">

        <div class="departments">

            <h3 style="text-align:right; color:white;" id="depname"> </h3>
            <br /><br />
            <div class="row " id="demo">

            </div>
        </div>

    </div>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-9">
                            <input type="search" id="search" class="form-control" placeholder="بحث عن فيلم, قناة, مسلسل" />
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-success btn-block" onclick="search()">بحث</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">إغلاق</button>
                </div>
            </div>
        </div>
    </div> 

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<script>
            var videos = [];
            var queryString = decodeURIComponent(window.location.search);
            queryString = queryString.substring(7);
            var queries = queryString.split("&para2=");
            for (var i = 0; i < queries.length; i++)
            {
                var derpartmentid = queries[0] ;
                var derpartmentname = queries[1] ;
            }
 
			function allmovies(){
				var username = sessionStorage.getItem("username")
                var password = sessionStorage.getItem("password")
                
				let credintials = {
							username: username,
							password: password,
							action: "get_vod_streams"
					};
               
				$.ajax({
			        url: "http://cobraa.in:8000/player_api.php",
			        dataType: 'text',
			        type: "post",
	                contentType: 'application/x-www-form-urlencoded',
			        data: credintials,
			        dataType: 'json',
			        success: function(data) {

			            for (i = 0; i < data.length; i++) {   
                            
                            if(data[i]["category_id"]==derpartmentid){
                                videos.push(data[i]);
                                var movieid = data[i]["stream_id"];
                                var querymovString = "?para1=" + movieid; 
                                var append = '<div class="col-md-3 col-lg-3 col-xl-3 demo"><a href="beforePlay.html'+ querymovString +'" id=demo'+ i +' width="100"/></a></div>'
    
                                $("#demo").last().append(append);
                                var demo = document.getElementById('demo'+i);
                                var imgsrc = data[i]["stream_icon"];
                                var vedioname = data[i]["name"];
                                document.getElementById('depname').innerHTML = derpartmentname;
                                demo.innerHTML = '<div class="card" style="background-color:#23274a; margin-bottom:20px;">'+
                                '<center><img src="'+imgsrc+'" width="120" style="padding-top:20px;"></center>'+
                                '<br />'+
                                '<p class="text-center text-light">'+vedioname+'</p>'+
                                '</div>';
                            }
			            }
                        sessionStorage.setItem("derpartmentid", derpartmentid)
                        sessionStorage.setItem("derpartmentname", derpartmentname)
			        }
			    }).done(function(msg) {
			        
			    });
			}

            function search(){
				var search = document.getElementById('search').value;
				console.log('xx');
				$("#demo").empty();
				for (i = 0; i < videos.length; i++) {
					
					if(videos[i]["name"].toLowerCase().includes(search.toLowerCase())){
						var append = '<div class="col-md-3 col-lg-3 col-xl-3"><a id=demo'+ i +' width="100"/></a></div>'

						$("#demo").last().append(append);
						var demo = document.getElementById('demo'+i);

						demo.href = videos[i]["direct_source"];
						var imgsrc = videos[i]["stream_icon"];
						var vedioname = videos[i]["name"];
						demo.innerHTML = '<div class="card" style="background-color:#23274a; margin-bottom:20px;">'+
						'<center><img src="'+imgsrc+'" width="120" style="padding-top:20px;"></center>'+
						'<br />'+
						'<p class="text-center text-light">'+vedioname+'</p>'+
						'</div>';
					}
				}
				
			}
		</script>
</body>

</html>