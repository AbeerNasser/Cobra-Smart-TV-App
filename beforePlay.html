<!DOCTYPE html>
<html lang="ar-eg">

<head>
    <title>COBRA IPTV</title>
    <!-- Custom Stylesheet -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/fa/css/all.css" rel="stylesheet">
    <script src="assets/js/jq.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script>
//ES5
$.fn.stars = function() {
    return $(this).each(function() {
        var rating = $(this).data("rating");
        var fullStar = new Array(Math.floor(rating + 1)).join('<i class="fas fa-star"></i>');
        var halfStar = ((rating%1) !== 0) ? '<i class="fas fa-star-half-alt"></i>': '';
        var noStar = new Array(Math.floor($(this).data("numStars") + 1 - rating)).join('<i class="far fa-star"></i>');
        $(this).html(fullStar + halfStar + noStar);
    });
}

//ES6
$.fn.stars = function() {
    return $(this).each(function() {
        const rating = $(this).data("rating");
        const numStars = $(this).data("numStars");
        const fullStar = '<i class="fas fa-star"></i>'.repeat(Math.floor(rating));
        const halfStar = (rating%1!== 0) ? '<i class="fas fa-star-half-alt"></i>': '';
        const noStar = '<i class="far fa-star"></i>'.repeat(Math.floor(numStars-rating));
        $(this).html(`${fullStar}${halfStar}${noStar}`);
    });
}
    </script>
</head>

<body style="background-color:#060a2f; direction:rtl; font-family:Tajawal;" onLoad="movieDetails()">

    <div class="container">
        <div class="mainHeader">
            <div class="row">

                <div class="col-md-3 col-lg-3 col-xl-3" style="text-align:right;">
                    <a data-toggle="modal" data-target="#searchModal"><img src="assets/images/search.png" width="30" /></a>
                </div>

                <div class="col-md-6 col-lg-6 col-xl-6">
                    <center>
                        <img src="assets/images/MainLogo.png" width="200" />
                    </center>
                </div>

                <div class="col-md-3 col-lg-3 col-xl-3">
                    <a id="back"><img src="assets/images/back.png" width="30" style="margin-right:20px;" /></a>
                </div>
            </div>
        </div>

        <hr class="diver">

        <div class="departments" id="demo">
            <div class="row">
                <div class="col-md-4">
                    <div class="poster">
                        <!-- <img src="assets/images/moviePosterBig.jpg" height="450"/> -->
                        <img id="poster" height="450"/>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="details">
                        <h1 id="moviename"></h1>
                        <div class="rates" id="rating">
                            <p>سنة العرض : <span id="year"></span></p>
                            <span class="stars" data-rating="3.5" data-num-stars="5" ></span>
                        
                        </div>
                        <div class="descriptionAr" id="plot"></div>
                        <div class="cast" >
                            فريق العمل :
                            <br />
                            <p id="cast"></p>
                        </div>
                        <div class="play">
                            <a id="play" class="btn btn-success btn-lg btn-block">مشاهدة الأن</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-md-9">
                                <input type="search" class="form-control" placeholder="بحث عن فيلم, قناة, مسلسل" />
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-success btn-block">بحث</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">إغلاق</button>
                </div>
            </div>
        </div>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

    <script>
        var queryString = decodeURIComponent(window.location.search);
        queryString = queryString.substring(7);

        function movieDetails(){
            let credintials = {
                username: "73377381913xe",
                password: "TgUAOLczeh",
                action: "get_vod_info",
                vod_id: queryString
            };
            var derpartmentid = sessionStorage.getItem("derpartmentid");
            var derpartmentname = sessionStorage.getItem("derpartmentname");

            var queryBack = "?para1=" + derpartmentid + "&para2=" + derpartmentname;
            console.log(derpartmentid);
            var back = document.getElementById('back');
            back.href = "department.html" + queryBack

            $.ajax({
                url: "http://cobraa.in:8000/player_api.php",
                dataType: 'text',
                type: "post",
                contentType: 'application/x-www-form-urlencoded',
                data: credintials,
                dataType: 'json',
                success: function(data) {                             
                    var poster = document.getElementById('poster');
                    poster.src = data['info']["movie_image"];

                    var poster = document.getElementById('cast');
                    cast.innerHTML = data['info']["cast"];

                    var plot=document.getElementById('plot');
                    plot.innerHTML = data['info']["plot"];

                    var moviename=document.getElementById('moviename');
                    moviename.innerHTML = data['movie_data']["name"];
                        
                    var year=document.getElementById('year');
                    year.innerHTML = data['info']["year"];

                    var play = document.getElementById('play');
                            
                    play.href = "http://cobraa.in:8000/movie/" + credintials['username'] + "/" + credintials['password'] + "/" + credintials['vod_id'];
                }
            }).done(function(msg) {
                
            });
        }
    </script>
         
</body>

</html>